<%
  # Determine if this creates a new path
  existing_path_colors = game.player_paths.pluck(:color)
  is_new_path = !existing_path_colors.include?(card['color'])
  card_color_class = case card['color']
    when 'red' then 'border-red-500 text-red-600 hover:border-red-600 hover:shadow-red-200'
    when 'blue' then 'border-blue-500 text-blue-600 hover:border-blue-600 hover:shadow-blue-200'
    when 'green' then 'border-green-500 text-green-600 hover:border-green-600 hover:shadow-green-200'
    when 'yellow' then 'border-yellow-500 text-yellow-600 hover:border-yellow-600 hover:shadow-yellow-200'
    when 'purple' then 'border-purple-500 text-purple-600 hover:border-purple-600 hover:shadow-purple-200'
  end
%>

<div class="relative group flex flex-col items-center gap-2">
  <%= form_with url: play_card_game_path(game), method: :post, local: true, class: "contents" do |f| %>
    <%= f.hidden_field :card_index, value: index %>
    <%= f.hidden_field :color, value: card['color'] %>

    <button type="submit" class="w-28 h-40 rounded-2xl shadow-lg border-4 flex flex-col items-center justify-center bg-gradient-to-br from-white to-gray-50 hover:shadow-2xl hover:scale-105 hover:-translate-y-2 transition-all duration-200 cursor-pointer <%= card_color_class %> active:scale-95">
      <div class="text-6xl font-black mb-1"><%= card['number'] %></div>
      <div class="text-sm uppercase font-bold tracking-wider"><%= card['color'] %></div>
      <div class="text-xs mt-1 opacity-60">Click to play</div>

      <% if is_new_path %>
        <div class="absolute -top-3 -right-3 bg-orange-600 text-white text-sm font-black px-3 py-1.5 rounded-full shadow-xl border-3 border-white animate-pulse">
          -2ðŸ’³
        </div>
      <% end %>
    </button>
  <% end %>

  <!-- Discard button -->
  <%= form_with url: discard_card_game_path(game), method: :post, local: true, class: "contents" do |f| %>
    <%= f.hidden_field :card_index, value: index %>
    <button type="submit" class="text-xs px-2 py-1 bg-gray-300 hover:bg-gray-400 rounded text-gray-700 opacity-50 hover:opacity-100 transition-opacity">
      Discard
    </button>
  <% end %>

  <!-- Tooltip on hover -->
  <div class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 hidden group-hover:block z-10">
    <div class="bg-gray-900 text-white text-xs rounded-lg py-2 px-3 whitespace-nowrap shadow-xl">
      <% if is_new_path %>
        Click to start <%= card['color'] %> path (costs 2 cards)
      <% else %>
        Click to add to your <%= card['color'] %> path
      <% end %>
      <div class="absolute top-full left-1/2 -translate-x-1/2 -mt-1 border-4 border-transparent border-t-gray-900"></div>
    </div>
  </div>
</div>
